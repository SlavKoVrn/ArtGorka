<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REST API Tester</title>
    <link rel="stylesheet" href="/css/main.css">
</head>
<body>
    <div class="container">
        <h1>ðŸš€ REST API Tester</h1>
        
        <div class="method-select">
            <button class="method-btn get active" data-method="GET">GET</button>
            <button class="method-btn post" data-method="POST">POST</button>
            <button class="method-btn put" data-method="PUT">PUT</button>
            <button class="method-btn patch" data-method="PATCH">PATCH</button>
            <button class="method-btn delete" data-method="DELETE">DELETE</button>
        </div>

        <div class="form-group">
            <label for="url">API URL</label>
            <input type="url" id="url" placeholder="{{api_endpoint}}" value="{{api_endpoint}}">
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="headers">Headers</button>
            <button class="tab" data-tab="body">Body</button>
            <button class="tab" data-tab="history">History</button>
        </div>

        <div class="tab-content active" id="headers-tab">
            <div class="form-group">
                <label for="headers">Headers (JSON format)</label>
                <textarea id="headers" placeholder='{"Content-Type": "application/json", "Authorization": "Bearer token"}'>{}</textarea>
            </div>
        </div>

        <div class="tab-content" id="body-tab">
            <div class="form-group">
                <label for="body">Request Body (JSON format)</label>
                <textarea id="body" placeholder='{"key": "value"}'>{
  "title": "foo",
  "body": "bar",
  "userId": 1
}</textarea>
            </div>
        </div>

        <div class="tab-content" id="history-tab">
            <div id="history-list"></div>
        </div>

        <button class="send-btn" id="sendBtn">Send Request</button>

        <div class="response-section" id="responseSection" style="display: none;">
            <div class="response-header">
                <h3>Response</h3>
                <div>
                    <span class="status-code" id="statusCode"></span>
                    <button class="copy-btn" id="copyBtn">Copy</button>
                </div>
            </div>
            <div class="response-body" id="responseBody"></div>
        </div>
    </div>

    <script>
        // API Tester Application
        class APITester {
            constructor() {
                this.currentMethod = 'GET';
                this.history = [];
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadHistory();
            }

            bindEvents() {
                // Method buttons
                document.querySelectorAll('.method-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        document.querySelectorAll('.method-btn').forEach(b => b.classList.remove('active'));
                        e.target.classList.add('active');
                        this.currentMethod = e.target.dataset.method;
                        this.toggleBodyField();
                    });
                });

                // Tabs
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', (e) => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        e.target.classList.add('active');
                        document.getElementById(`${e.target.dataset.tab}-tab`).classList.add('active');
                    });
                });

                // Send button
                document.getElementById('sendBtn').addEventListener('click', () => this.sendRequest());

                // Copy button
                document.getElementById('copyBtn').addEventListener('click', () => this.copyResponse());

                // Initial body field toggle
                this.toggleBodyField();
            }

            toggleBodyField() {
                const bodyTab = document.querySelector('[data-tab="body"]');
                if (['GET', 'DELETE'].includes(this.currentMethod)) {
                    bodyTab.style.display = 'none';
                    if (bodyTab.classList.contains('active')) {
                        document.querySelector('[data-tab="headers"]').click();
                    }
                } else {
                    bodyTab.style.display = 'block';
                }
            }

            async sendRequest() {
                const url = document.getElementById('url').value.trim();
                const headersText = document.getElementById('headers').value.trim();
                const bodyText = document.getElementById('body').value.trim();

                if (!url) {
                    alert('Please enter a URL');
                    return;
                }

                let headers = {};
                let body = null;

                try {
                    if (headersText) {
                        headers = JSON.parse(headersText);
                    }
                } catch (e) {
                    alert('Invalid JSON in headers');
                    return;
                }

                try {
                    if (bodyText && !['GET', 'DELETE'].includes(this.currentMethod)) {
                        body = JSON.parse(bodyText);
                    }
                } catch (e) {
                    alert('Invalid JSON in body');
                    return;
                }

                // Show loading
                this.showLoading();

                const startTime = Date.now();

                try {
                    const options = {
                        method: this.currentMethod,
                        headers: {
                            'Content-Type': 'application/json',
                            ...headers
                        }
                    };

                    if (body && !['GET', 'DELETE'].includes(this.currentMethod)) {
                        options.body = JSON.stringify(body);
                    }

                    const response = await fetch(url, options);
                    const endTime = Date.now();
                    const duration = endTime - startTime;

                    const data = await response.json().catch(() => response.text());

                    this.displayResponse(response.status, data, duration);
                    this.addToHistory(url, this.currentMethod, response.status, duration);

                } catch (error) {
                    this.displayResponse(0, { error: error.message }, Date.now() - startTime);
                }
            }

            showLoading() {
                document.getElementById('responseSection').style.display = 'block';
                document.getElementById('responseBody').innerHTML = `
                    <div class="loading">
                        <div class="spinner"></div>
                        <p>Sending request...</p>
                    </div>
                `;
                document.getElementById('sendBtn').disabled = true;
            }

            displayResponse(status, data, duration) {
                const responseSection = document.getElementById('responseSection');
                const statusCode = document.getElementById('statusCode');
                const responseBody = document.getElementById('responseBody');

                responseSection.style.display = 'block';
                document.getElementById('sendBtn').disabled = false;

                // Status code styling
                statusCode.textContent = `${status} ${duration}ms`;
                statusCode.className = 'status-code';
                if (status >= 200 && status < 300) {
                    statusCode.classList.add('status-success');
                } else if (status >= 400) {
                    statusCode.classList.add('status-error');
                } else {
                    statusCode.classList.add('status-info');
                }

                // Format response
                if (typeof data === 'object') {
                    responseBody.textContent = JSON.stringify(data, null, 2);
                } else {
                    responseBody.textContent = data;
                }
            }

            addToHistory(url, method, status, duration) {
                const entry = {
                    url,
                    method,
                    status,
                    duration,
                    timestamp: new Date().toLocaleString()
                };

                this.history.unshift(entry);
                if (this.history.length > 10) {
                    this.history.pop();
                }

                localStorage.setItem('apiHistory', JSON.stringify(this.history));
                this.renderHistory();
            }

            loadHistory() {
                const saved = localStorage.getItem('apiHistory');
                if (saved) {
                    this.history = JSON.parse(saved);
                    this.renderHistory();
                }
            }

            renderHistory() {
                const historyList = document.getElementById('history-list');
                historyList.innerHTML = this.history.map((item, index) => `
                    <div class="history-item" onclick="apiTester.loadHistoryItem(${index})">
                        <strong>${item.method}</strong> - ${item.url}<br>
                        <small>Status: ${item.status} | Time: ${item.duration}ms | ${item.timestamp}</small>
                    </div>
                `).join('');
            }

            loadHistoryItem(index) {
                const item = this.history[index];
                document.getElementById('url').value = item.url;
                document.querySelector(`[data-method="${item.method}"]`).click();
            }

            copyResponse() {
                const text = document.getElementById('responseBody').textContent;
                navigator.clipboard.writeText(text).then(() => {
                    const copyBtn = document.getElementById('copyBtn');
                    copyBtn.textContent = 'Copied!';
                    setTimeout(() => copyBtn.textContent = 'Copy', 2000);
                });
            }
        }

        // Initialize the application
        const apiTester = new APITester();
    </script>
</body>
</html>